---
const {
  PUBLIC_GISCUS_REPO,
  PUBLIC_GISCUS_REPO_ID,
  PUBLIC_GISCUS_CATEGORY,
  PUBLIC_GISCUS_CATEGORY_ID,
  PUBLIC_GISCUS_MAPPING,
  PUBLIC_GISCUS_LANG,
  PUBLIC_GISCUS_THEME,
  PUBLIC_GISCUS_STRICT,
  PUBLIC_GISCUS_REACTIONS_ENABLED,
  PUBLIC_GISCUS_EMIT_METADATA,
  PUBLIC_GISCUS_INPUT_POSITION,
  PUBLIC_GISCUS_LOADING,
} = import.meta.env;

const giscusConfig = {
  repo: PUBLIC_GISCUS_REPO,
  repoId: PUBLIC_GISCUS_REPO_ID,
  category: PUBLIC_GISCUS_CATEGORY,
  categoryId: PUBLIC_GISCUS_CATEGORY_ID,
  mapping: PUBLIC_GISCUS_MAPPING ?? 'title',
  lang: PUBLIC_GISCUS_LANG ?? 'ko',
  theme: PUBLIC_GISCUS_THEME ?? 'light',
  strict: PUBLIC_GISCUS_STRICT ?? '1',
  reactionsEnabled: PUBLIC_GISCUS_REACTIONS_ENABLED ?? '1',
  emitMetadata: PUBLIC_GISCUS_EMIT_METADATA ?? '0',
  inputPosition: PUBLIC_GISCUS_INPUT_POSITION ?? 'bottom',
  loading: PUBLIC_GISCUS_LOADING ?? 'lazy',
};

const isConfigured = Boolean(
  giscusConfig.repo &&
    giscusConfig.repoId &&
    giscusConfig.category &&
    giscusConfig.categoryId,
);
---

<section id="comments" class="comments" aria-label="Post comments">
	{
		isConfigured ? (
			<>
				<div class="giscus" />
				<script
					src="https://giscus.app/client.js"
					data-repo={giscusConfig.repo}
					data-repo-id={giscusConfig.repoId}
					data-category={giscusConfig.category}
					data-category-id={giscusConfig.categoryId}
					data-mapping={giscusConfig.mapping}
					data-strict={giscusConfig.strict}
					data-reactions-enabled={giscusConfig.reactionsEnabled}
					data-emit-metadata={giscusConfig.emitMetadata}
					data-input-position={giscusConfig.inputPosition}
					data-theme={giscusConfig.theme}
					data-lang={giscusConfig.lang}
					data-loading={giscusConfig.loading}
					crossorigin="anonymous"
					async
				/>
			</>
		) : (
			<p class="comments__placeholder" role="status">
				Giscus comments are not configured yet. Define the required `PUBLIC_GISCUS_*`
				environment variables to enable the discussion widget.
			</p>
		)
	}
	<noscript class="comments__noscript">
		Enable JavaScript to view comments powered by Giscus.
	</noscript>
</section>

<style>
	.comments {
		margin-top: 3rem;
		padding-top: 2rem;
		border-top: 1px solid rgba(var(--gray-light), 0.35);
	}

	.comments__placeholder {
		margin: 0;
		padding: 1rem;
		background: rgba(var(--gray-light), 0.15);
		border-radius: 0.5rem;
		font-size: 0.95rem;
		color: rgb(var(--gray));
	}

	.comments__noscript {
		display: inline-block;
		margin-top: 1rem;
		font-size: 0.85rem;
		color: rgba(var(--gray), 0.75);
	}
</style>
